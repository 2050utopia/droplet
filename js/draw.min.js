/*! ice-editor 2014-01-16 */
(function(){var Group,NoRectangle,Path,Point,QuadTree,Rectangle,Text,exports,_CTX,_area,_intersects,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};_area=function(a,b,c){return(b.x-a.x)*(c.y-a.y)-(c.x-a.x)*(b.y-a.y)},_intersects=function(a,b,c,d){return _area(a,b,c)>0!=_area(a,b,d)>0&&_area(c,d,a)>0!=_area(c,d,b)>0},exports={},exports.Point=Point=function(){function Point(x,y){this.x=x,this.y=y}return Point.prototype.clone=function(){return new Point(this.x,this.y)},Point.prototype.translate=function(vector){return this.x+=vector.x,this.y+=vector.y},Point.prototype.add=function(x,y){return this.x+=x,this.y+=y},Point.prototype.copy=function(point){return this.x=point.x,this.y=point.y},Point.prototype.from=function(point){return new Point(this.x-point.x,this.y-point.y)},Point.prototype.clear=function(){return this.x=this.y=0},Point}(),exports.Rectangle=Rectangle=function(){function Rectangle(x,y,width,height){this.x=x,this.y=y,this.width=width,this.height=height}return Rectangle.prototype.contains=function(point){return null!=this.x&&null!=this.y&&!(point.x<this.x||point.x>this.x+this.width||point.y<this.y||point.y>this.y+this.height)},Rectangle.prototype.copy=function(rect){return this.x=rect.x,this.y=rect.y,this.width=rect.width,this.height=rect.height},Rectangle.prototype.clear=function(){return this.width=this.height=0,this.x=this.y=null},Rectangle.prototype.bottom=function(){return this.y+this.height},Rectangle.prototype.right=function(){return this.x+this.width},Rectangle.prototype.fill=function(ctx,style){return ctx.fillStyle=style,ctx.fillRect(this.x,this.y,this.width,this.height)},Rectangle.prototype.unite=function(rectangle){return null==this.x||null==this.y?this.copy(rectangle):(this.width=Math.max(this.right(),rectangle.right())-(this.x=Math.min(this.x,rectangle.x)),this.height=Math.max(this.bottom(),rectangle.bottom())-(this.y=Math.min(this.y,rectangle.y)))},Rectangle.prototype.swallow=function(point){return this.x&&null!=this.y?(this.width=Math.max(this.right(),point.x)-(this.x=Math.min(this.x,point.x)),this.height=Math.max(this.bottom(),point.y)-(this.y=Math.min(this.y,point.y))):this.copy(new Rectangle(point.x,point.y,0,0))},Rectangle.prototype.overlap=function(rectangle){return null!=this.x&&null!=this.y&&!(rectangle.x<this.x||rectangle.y<y||rectangle.right()>this.right()||rectangle.bottom()>this.bottom())},Rectangle.prototype.translate=function(vector){return this.x+=vector.x,this.y+=vector.y},Rectangle}(),exports.NoRectangle=NoRectangle=function(_super){function NoRectangle(){NoRectangle.__super__.constructor.call(this,null,null,0,0)}return __extends(NoRectangle,_super),NoRectangle}(Rectangle),exports.Path=Path=function(){function Path(){this._points=[],this._cachedTranslation=new Point(0,0),this._cacheFlag=!1,this._bounds=new NoRectangle,this.style={strokeColor:"#000",fillColor:null}}return Path.prototype._clearCache=function(){var point,_i,_len,_ref;if(this._cacheFlag){for(_ref=this._points,_i=0,_len=_ref.length;_len>_i;_i++)point=_ref[_i],point.translate(this._cachedTranslation);return this._bounds.translate(this._cachedTranslation),this._cachedTranslation.clear(),this._cacheFlag=!1}},Path.prototype.recompute=function(){var point,_i,_len,_ref,_results;for(this._bounds=new NoRectangle,_ref=this._points,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)point=_ref[_i],_results.push(this._bounds.swallow(point));return _results},Path.prototype.push=function(point){return this._points.push(point),this._bounds.swallow(point)},Path.prototype.unshift=function(point){return this._points.unshift(point),this._bounds.swallow(point)},Path.prototype.contains=function(point){var count,dest,end,last,_i,_len,_ref;for(this._clearCache(),dest=new Point(this._bounds.x-1,point.y),count=0,last=this._points[this._points.length-1],_ref=this._points,_i=0,_len=_ref.length;_len>_i;_i++)end=_ref[_i],_intersects(last,end,point,dest)&&(count+=1),last=end;return count%2===1},Path.prototype.bounds=function(){return this._clearCache(),this._bounds},Path.prototype.translate=function(vector){return this._cachedTranslation.translate(vector),this._cacheFlag=!0},Path.prototype.draw=function(ctx){var last_point,point,_i,_len,_ref;for(this._clearCache(),ctx.strokeStyle=this.style.strokeColor,null!=this.style.fillColor&&(ctx.fillStyle=this.style.fillColor),ctx.beginPath(),ctx.moveTo(this._points[0].x,this._points[0].y),last_point=this._points[0],_ref=this._points,_i=0,_len=_ref.length;_len>_i;_i++)point=_ref[_i],ctx.lineTo(last_point.x,point.y),ctx.lineTo(point.x,point.y),last_point=point;return ctx.lineTo(this._points[0].x,this._points[0].y),null!=this.style.fillColor&&ctx.fill(),ctx.stroke()},Path}(),_CTX=null,exports.Text=Text=function(){function Text(point,value){this.point=point,this.value=value,_CTX.font=Text.prototype._FONT_SIZE+"px Courier New",this._bounds=new Rectangle(this.point.x,this.point.y,_CTX.measureText(this.value).width,Text.prototype._FONT_SIZE)}return Text.prototype._FONT_SIZE=15,Text.prototype.bounds=function(){return this._bounds},Text.prototype.contains=function(point){return this._bounds.contains(point)},Text.prototype.translate=function(vector){return this.point.translate(vector),this._bounds.translate(vector)},Text.prototype.setPosition=function(point){return this.translate(point.from(this.point))},Text.prototype.draw=function(ctx){return ctx.textBaseline="top",ctx.font=Text.prototype._FONT_SIZE+"px Courier New",ctx.fillStyle="#000",ctx.fillText(this.value,this.point.x,this.point.y)},Text}(),exports._setCTX=function(ctx){return _CTX=ctx},exports.Group=Group=function(){function Group(){this.children=[],this._cachedTranslation=new Point(0,0),this._cacheFlag=!1,this._bounds=new NoRectangle}return Group.prototype._clearCache=function(){var child,_i,_len,_ref;if(this._cacheFlag){for(_ref=this.children,_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],child.translate(this._cachedTranslation);return this._cachedTranslation.clear(),this._cacheFlag=!1}},Group.prototype.empty=function(){return this.children.length=0,this._bounds.clear()},Group.prototype.recompute=function(){var child,_i,_len,_ref,_results;for(this._bounds.clear(),_ref=this.children,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],_results.push(this._bounds.unite(child.bounds()));return _results},Group.prototype.translate=function(vector){return this._cachedTranslation.translate(vector)},Group.prototype.push=function(child){return this.children.push(child),this._bounds.unite(child.bounds())},Group.prototype.bounds=function(){return this._clearCache(),this._bounds},Group.prototype.setPosition=function(point){return this.translate(point.from(new Point(this.bounds().x,this.bounds.y)))},Group.prototype.contains=function(point){var child,_i,_len,_ref;for(this._clearCache,_ref=this.children,_i=0,_len=_ref.length;_len>_i;_i++)if(child=_ref[_i],child.contains(point))return!0;return!1},Group.prototype.draw=function(ctx){var child,_i,_len,_ref,_results;for(_ref=this.children,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],_results.push(child.draw(ctx));return _results},Group}(),exports.QuadTree=QuadTree=function(){function QuadTree(bounds){this.bounds=bounds,this.children=null,this.contents=[]}return QuadTree.prototype._split=function(){var child,content,_i,_j,_len,_len1,_ref,_ref1;for(this.children=[new QuadTree(new Rectangle(this.bounds.x+this.bounds.width/2,this.bounds.y,this.bounds.height/2,this.bounds.width/2)),new QuadTree(new Rectangle(this.bounds.x,this.bounds.y,this.bounds.height/2,this.bounds.width/2)),new QuadTree(new Rectangle(this.bounds.x,this.bounds.y+this.bounds.width/2,this.bounds.height/2,this.bounds.width/2)),new QuadTree(new Rectangle(this.bounds.x+this.bounds.width/2,this.bounds.y+this.bounds.width/2,this.bounds.height/2,this.bounds.width/2))],_ref=this.contents,_i=0,_len=_ref.length;_len>_i;_i++)for(content=_ref[_i],_ref1=this.children,_j=0,_len1=_ref1.length;_len1>_j;_j++)child=_ref1[_j],content.rect.overlap(child.bounds)&&child.insert(content);return this.contents=[]},QuadTree.prototype.insert=function(obj){var child,_i,_len,_ref,_results;if(null!=this.children){for(_ref=this.children,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],obj.rect.overlap(child.bounds)?_results.push(child.insert(obj)):_results.push(void 0);return _results}return this.contents.push(obj)},QuadTree.prototype.find=function(point){var child,content,_i,_j,_len,_len1,_ref,_ref1;if(null!=this.children){for(_ref=this.children,_i=0,_len=_ref.length;_len>_i;_i++)if(child=_ref[_i],child.bounds.contains(point))return child.find(point)}else for(_ref1=this.contents,_j=0,_len1=_ref1.length;_len1>_j;_j++)if(content=_ref1[_j],content.rect.contains(point))return content},QuadTree}(),window.draw=exports}).call(this);