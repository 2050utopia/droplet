/*! ice-editor 2014-01-07 */
(function(){var Block,BlockEndToken,BlockPaper,BlockStartToken,INDENT,IcePaper,Indent,IndentEndToken,IndentPaper,IndentStartToken,NewlineToken,PADDING,Socket,SocketEndToken,SocketPaper,SocketStartToken,TextToken,TextTokenPaper,Token,indentParse,lispParse,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Block=function(){function Block(contents){var head,token,_i,_len;for(this.start=new BlockStartToken(this),this.end=new BlockEndToken(this),this.type="block",head=this.start,_i=0,_len=contents.length;_len>_i;_i++)token=contents[_i],head=head.append(token.clone());head.append(this.end),this.paper=new BlockPaper(this)}return Block.prototype.embedded=function(){return"socketStart"===this.start.prev.type},Block.prototype.contents=function(){var contents,head;for(contents=[],head=this.start;head!==this.end;)contents.push(head),head=head.next;return contents.push(this.end),contents},Block.prototype.lines=function(){var contents,currentLine,head;for(contents=[],currentLine=[],head=this.start;head!==this.end;)contents.push(head),"newline"===head.type&&(contents.push(currentLine),currentLine=[]),head=head.next;return currentLine.push(this.end),contents.push(currentLine),contents},Block.prototype._moveTo=function(parent){return null!=this.start.prev&&(this.start.prev.next=this.end.next),null!=this.end.next&&(this.end.next.prev=this.start.prev),this.start.prev=this.end.next=null,null!=parent?(this.end.next=parent.next,parent.next.prev=this.end,parent.next=this.start,this.start.prev=parent):void 0},Block.prototype.findBlock=function(f){var head;for(head=this.start.next;head!==this.end;){if("blockStart"===head.type&&f(head.block))return head.block.findBlock(f);head=head.next}return this},Block.prototype.find=function(f){var head;for(head=this.start.next;head!==this.end;){if("blockStart"===head.type&&f(head.block))return head.block.find(f);if("indentStart"===head.type&&f(head.indent))return head.indent.find(f);if("socketStart"===head.type&&f(head.socket))return head.socket.find(f);head=head.next}return this},Block.prototype.toString=function(state){var string;return string=this.start.toString(state),string.slice(0,+(string.length-this.end.toString(state).length-1)+1||9e9)},Block}(),Indent=function(){function Indent(contents,depth){var block,head,_i,_len;for(this.depth=depth,this.start=new IndentStartToken(this),this.end=new IndentEndToken(this),this.type="indent",head=this.start,_i=0,_len=contents.length;_len>_i;_i++)block=contents[_i],head=head.append(block.clone());head.append(this.end),this.paper=new IndentPaper(this)}return Indent.prototype.embedded=function(){return!1},Indent.prototype.toString=function(state){var string;return string=this.start.toString(state),string.slice(0,+(string.length-this.end.toString(state).length-1)+1||9e9)},Indent.prototype.find=function(f){var head;for(head=this.start.next;head!==this.end;){if("blockStart"===head.type&&f(head.block))return head.block.find(f);if("indentStart"===head.type&&f(head.indent))return head.indent.find(f);if("socketStart"===head.type&&f(head.socket))return head.socket.find(f);head=head.next}return this},Indent}(),Socket=function(){function Socket(content){this.start=new SocketStartToken(this),this.end=new SocketEndToken(this),null!=content?(this.start.next=this.content.start,this.end.prev=this.content.end):(this.start.next=this.end,this.end.prev=this.start),this.type="socket",this.paper=new SocketPaper(this)}return Socket.prototype.embedded=function(){return!1},Socket.prototype.content=function(){return this.start.next!==this.end?this.start.next.block:null},Socket.prototype.find=function(f){var head;for(head=this.start.next;head!==this.end;){if("blockStart"===head.type&&f(head.block))return head.block.find(f);if("indentStart"===head.type&&f(head.indent))return head.indent.find(f);if("socketStart"===head.type&&f(head.socket))return head.socket.find(f);head=head.next}return this},Socket.prototype.toString=function(){return this.content?this.content.toString():""},Socket}(),Token=function(){function Token(){this.prev=this.next=null}return Token.prototype.append=function(token){return token.prev=this,this.next=token},Token.prototype.insert=function(token){return null!=this.next&&(token.next=this.next,this.next.prev=token),token.prev=this,this.next=token,this.next},Token.prototype.remove=function(){return null!=this.prev&&(this.prev.next=this.next),null!=this.next&&(this.next.prev=this.prev),this.prev=this.next=null},Token.prototype.toString=function(state){return null!=this.next?this.next.toString(state):""},Token}(),TextToken=function(_super){function TextToken(value){this.value=value,this.prev=this.next=null,this.paper=new TextTokenPaper(this),this.type="text"}return __extends(TextToken,_super),TextToken.prototype.toString=function(state){return this.value+(null!=this.next?this.next.toString(state):"")},TextToken}(Token),BlockStartToken=function(_super){function BlockStartToken(block){this.block=block,this.prev=this.next=null,this.type="blockStart"}return __extends(BlockStartToken,_super),BlockStartToken}(Token),BlockEndToken=function(_super){function BlockEndToken(block){this.block=block,this.prev=this.next=null,this.type="blockEnd"}return __extends(BlockEndToken,_super),BlockEndToken}(Token),NewlineToken=function(_super){function NewlineToken(){this.prev=this.next=null,this.type="newline"}return __extends(NewlineToken,_super),NewlineToken.prototype.toString=function(state){return"\n"+state.indent+(this.next?this.next.toString(state):"")},NewlineToken}(Token),IndentStartToken=function(_super){function IndentStartToken(indent){this.indent=indent,this.prev=this.next=null,this.type="indentStart"}return __extends(IndentStartToken,_super),IndentStartToken.prototype.toString=function(state){return state.indent+=function(){var _i,_ref,_results;for(_results=[],_i=1,_ref=this.indent.depth;_ref>=1?_ref>=_i:_i>=_ref;_ref>=1?_i++:_i--)_results.push(" ");return _results}.call(this).join(""),this.next?this.next.toString(state):""},IndentStartToken}(Token),IndentEndToken=function(_super){function IndentEndToken(indent){this.indent=indent,this.prev=this.next=null,this.type="indentEnd"}return __extends(IndentEndToken,_super),IndentEndToken.prototype.toString=function(state){return state.indent=state.indent.slice(0,-this.indent.depth),this.next?this.next.toString(state):""},IndentEndToken}(Token),SocketStartToken=function(_super){function SocketStartToken(socket){this.socket=socket,this.prev=this.next=null,this.type="socketStart"}return __extends(SocketStartToken,_super),SocketStartToken}(Token),SocketEndToken=function(_super){function SocketEndToken(socket){this.socket=socket,this.prev=this.next=null,this.type="socketEnd"}return __extends(SocketEndToken,_super),SocketEndToken}(Token),lispParse=function(str){var block,block_stack,char,currentString,first,head,socket,socket_stack,_i,_len;for(currentString="",first=head=new TextToken(""),block_stack=[],socket_stack=[],_i=0,_len=str.length;_len>_i;_i++)switch(char=str[_i]){case"(":head=head.append(new TextToken(currentString)),block_stack.push(block=new Block([])),socket_stack.push(socket=new Socket(block)),head=head.append(socket.start),head=head.append(block.start),head=head.append(new TextToken("(")),currentString="";break;case")":head=head.append(new TextToken(currentString)),head=head.append(new TextToken(")")),head=head.append(block_stack.pop().end),head=head.append(socket_stack.pop().end),currentString="";break;case" ":head=head.append(new TextToken(currentString)),head=head.append(new TextToken(" ")),currentString="";break;case"\n":head=head.append(new TextToken(currentString)),head=head.append(new NewlineToken),currentString="";break;default:currentString+=char}return head=head.append(new TextToken(currentString)),first},indentParse=function(str){var block_stack,first,head,indent,line,lineate,lines,new_node,node,root,socket_stack,_i,_len;for(lines=str.split("\n"),node=root={parent:null,head:null,indent:-1,children:[]},_i=0,_len=lines.length;_len>_i;_i++){for(line=lines[_i],indent=line.length-line.trimLeft().length;indent<=node.indent;)node=node.parent;new_node={parent:node,head:line,indent:indent,children:[]},node.children.push(new_node),node=new_node}return head=first=new TextToken(""),block_stack=[],socket_stack=[],(lineate=function(_node){var block,char,child,currentString,socket,_indent,_j,_k,_len1,_len2,_ref,_ref1;if(null!=_node.head){for(head=head.append(new NewlineToken),currentString="",_ref=_node.head.slice(_node.indent),_j=0,_len1=_ref.length;_len1>_j;_j++)switch(char=_ref[_j]){case"(":head=head.append(new TextToken(currentString)),block_stack.push(block=new Block([])),socket_stack.push(socket=new Socket(block)),head=head.append(socket.start),head=head.append(block.start),head=head.append(new TextToken("(")),currentString="";break;case")":head=head.append(new TextToken(currentString)),head=head.append(new TextToken(")")),head=head.append(block_stack.pop().end),head=head.append(socket_stack.pop().end),currentString="";break;case" ":head=head.append(new TextToken(currentString)),head=head.append(new TextToken(" ")),currentString="";break;default:currentString+=char}head=head.append(new TextToken(currentString))}if(_node.children.length>0){for(_indent=new Indent([],_node.children[0].indent-_node.indent),head=head.append(_indent.start),_ref1=_node.children,_k=0,_len2=_ref1.length;_len2>_k;_k++)child=_ref1[_k],lineate(child);return head=head.append(_indent.end)}})(root),first=first.next.next.next.next.next},window.ICE={lispParse:lispParse,indentParse:indentParse},PADDING=2,INDENT=13,window.RUN_PAPER_TESTS=!1,IcePaper=function(){function IcePaper(block){this.block=block}return IcePaper.prototype.compute=function(){},IcePaper.prototype.draw=function(){},IcePaper.prototype.setLeftCenter=function(){},IcePaper.prototype.translate=function(){},IcePaper}(),IndentPaper=function(_super){function IndentPaper(block){this.block=block}return __extends(IndentPaper,_super),IndentPaper.prototype.compute=function(state){var axis,bottom,element,elements,head,line,lineGroup,lineStart,_i,_j,_len,_ref;for(this.point=new paper.Point(0,0),this.lines={},elements=[],this.lineStart=lineStart=state.line+=1,this.group=new paper.Group([]),this.children=[],head=this.block.start.next,head!==this.block.end&&(head=head.next);head!==this.block.end;)switch(head.type){case"text":element=head.paper.compute(state),elements.push(element),this.children.push(element),this.group.addChild(element.group),head=head.next;break;case"blockStart":element=head.block.paper.compute(state),elements.push(element),this.children.push(element),this.group.addChild(element.group),head=head.block.end.next;break;case"newline":state.line+=1,head=head.next;break;default:head=head.next}for(this.lineEnd=state.line,this.lineGroups={},axis=0,bottom=0,line=_i=lineStart,_ref=state.line;_ref>=lineStart?_ref>=_i:_i>=_ref;line=_ref>=lineStart?++_i:--_i){for(this.lineGroups[line]=lineGroup=[],_j=0,_len=elements.length;_len>_j;_j++)element=elements[_j],line in element.lines&&(lineGroup.push(element),this.group.addChild(element.group));this.setLeftCenter(line,new paper.Point(0,axis)),axis=bottom+this.lines[line].height/2,this.setLeftCenter(line,new paper.Point(0,axis)),bottom+=this.lines[line].height,this.lines[line].selected=!0}return this},IndentPaper.prototype.draw=function(){var child,_i,_len,_ref,_results;for(this.group.addChild(this._dropArea=new paper.Path.Rectangle(new paper.Rectangle(this.point.subtract(0,5),new paper.Size(100,10)))),this._dropArea.bringToFront(),_ref=this.children,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],_results.push(child.draw());return _results},IndentPaper.prototype.erase=function(){var child,_i,_len,_ref,_results;for(_ref=this.children,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],_results.push(child.erase());return _results},IndentPaper.prototype.setLeftCenter=function(line,point){var element,leftCenter,_i,_len,_ref;for(this.lines[line]=new paper.Rectangle(point,new paper.Size(0,0)),this.lines[line].point=point.subtract(0,this.lines[line].height/2),_ref=this.lineGroups[line],_i=0,_len=_ref.length;_len>_i;_i++)element=_ref[_i],element.setLeftCenter(line,new paper.Point(this.lines[line].right,point.y)),this.lines[line]=this.lines[line].unite(element.lines[line]);return leftCenter=this.lines[line].leftCenter,this.lines[line].point=point.subtract(0,this.lines[line].height/2),line===this.lineStart?this.point=this.lines[line].point:void 0},IndentPaper.prototype.translate=function(vector){var child,line,_i,_len,_ref,_results;this.point=this.point.add(vector);for(line in this.lines)this.lines[line].point=this.lines[line].point.add(vector);for(_ref=this.children,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],_results.push(child.translate(vector));return _results},IndentPaper.prototype.setPosition=function(point){var vector;return vector=point.subtract(this.point),this.translate(vector)},IndentPaper.prototype.getHeight=function(){var bounds,line;bounds=new paper.Rectangle(this.group.bounds.point,new paper.Size(0,0));for(line in this.lines)bounds=bounds.unite(this.lines[line]);return bounds.height},IndentPaper}(IcePaper),BlockPaper=function(_super){function BlockPaper(block){this.block=block}return __extends(BlockPaper,_super),BlockPaper.prototype.compute=function(state){var axis,bottom,cont,element,elements,head,indent,indents,line,lineGroup,lineStart,_i,_j,_k,_len,_len1,_ref,_ref1;for(this.lines={},elements=[],indents=[],this.lineStart=lineStart=state.line,this.indentedLines={},this.group=new paper.Group([]),this.children=[],this.indentEnds=[],head=this.block.start.next;head!==this.block.end;)switch(null==head.next,console.log(head.type,this.block.contents().indexOf(head)),head.type){case"text":element=head.paper.compute(state),elements.push(element),this.children.push(element),this.group.addChild(element.group),head=head.next;break;case"blockStart":element=head.block.paper.compute(state),elements.push(element),this.children.push(element),this.group.addChild(element.group),head=head.block.end.next;break;case"indentStart":indent=head.indent.paper.compute(state),indents.push(indent),this.children.push(indent),this.indentEnds[indent.lineEnd]=indent,this.group.addChild(indent.group),head=head.indent.end.next;break;case"socketStart":element=head.socket.paper.compute(state),elements.push(element),this.children.push(element),this.group.addChild(element.group),head=head.socket.end.next;break;case"newline":state.line+=1,head=head.next;break;default:head=head.next}for(this.lineEnd=state.line,this.lineGroups={},axis=0,bottom=0,line=_i=_ref=this.lineStart,_ref1=this.lineEnd;_ref1>=_ref?_ref1>=_i:_i>=_ref1;line=_ref1>=_ref?++_i:--_i){for(this.lineGroups[line]=lineGroup=[],cont=!1,_j=0,_len=indents.length;_len>_j;_j++)indent=indents[_j],line in indent.lines&&(line===indent.lineStart&&indent.setPosition(new paper.Point(INDENT,bottom)),this.indentedLines[line]=indent,this.lines[line]=new paper.Rectangle(indent.lines[line].point.subtract(INDENT,0),new paper.Size(INDENT,indent.lines[line].height)),line===indent.lineEnd&&(this.lines[line].height+=10),bottom+=indent.lines[line].height,cont=!0);if(!cont){for(_k=0,_len1=elements.length;_len1>_k;_k++)element=elements[_k],line in element.lines&&lineGroup.push(element);this.setLeftCenter(line,new paper.Point(0,axis)),axis=bottom+this.lines[line].height/2,this.setLeftCenter(line,new paper.Point(0,axis)),bottom+=this.lines[line].height,this.lines[line].selected=!0}}return this},BlockPaper.prototype.draw=function(){var child,line,_i,_j,_len,_ref,_ref1,_ref2;for(null!=this._container&&this._container.remove(),this._container=new paper.Path,this._container.strokeColor="black",this._container.fillColor="white",this.group.addChild(this._container),line=_i=_ref=this.lineStart,_ref1=this.lineEnd;_ref1>=_ref?_ref1>=_i:_i>=_ref1;line=_ref1>=_ref?++_i:--_i)line in this.indentEnds?(this._container.add(this.lines[line].topRight),this._container.add(this.lines[line].bottomRight.add(new paper.Point(0,-10))),this._container.add(this.lines[line].bottomRight.add(new paper.Point(200,-10))),this._container.add(this.lines[line].bottomRight.add(new paper.Point(200,0))),this._container.insert(0,this.lines[line].topLeft),this._container.insert(0,this.lines[line].bottomLeft)):(this._container.add(this.lines[line].topRight),this._container.add(this.lines[line].bottomRight),this._container.insert(0,this.lines[line].topLeft),this._container.insert(0,this.lines[line].bottomLeft));for(this.group.addChild(this._dropArea=new paper.Path.Rectangle(new paper.Rectangle(this._container.bounds.bottomLeft.subtract(0,5),new paper.Size(100,10)))),this._dropArea.closed=!0,this._container.closed=!0,_ref2=this.children,_j=0,_len=_ref2.length;_len>_j;_j++)child=_ref2[_j],child.draw();return this._dropArea.bringToFront(),this._container.sendToBack()},BlockPaper.prototype.erase=function(){var child,_i,_len,_ref,_results;for(null!=this._container&&this._container.remove(),null!=this._dropArea&&this._dropArea.remove(),_ref=this.children,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],_results.push(child.erase());return _results},BlockPaper.prototype.setLeftCenter=function(line,point){var element,leftCenter,_i,_len,_ref;if(line in this.indentEnds)return this.indentedLines[line].setLeftCenter(line,point.add(INDENT,-5)),this.lines[line].point=point.subtract(0,this.lines[line].height/2),void 0;if(line in this.indentedLines)return this.indentedLines[line].setLeftCenter(line,point.add(INDENT,0)),this.lines[line].point=point.subtract(0,this.lines[line].height/2),void 0;for(this.lines[line]=new paper.Rectangle(point,new paper.Size(PADDING,0)),this.lines[line].point=point.subtract(0,this.lines[line].height/2),_ref=this.lineGroups[line],_i=0,_len=_ref.length;_len>_i;_i++)element=_ref[_i],element.setLeftCenter(line,new paper.Point(this.lines[line].right,point.y)),this.lines[line]=this.lines[line].unite(element.lines[line]);return leftCenter=this.lines[line].leftCenter,this.lines[line].width+=PADDING,this.lines[line].height+=2*PADDING,this.lines[line].point=point.subtract(0,this.lines[line].height/2)},BlockPaper.prototype.translate=function(vector){var child,line,_i,_len,_ref,_results;null!=this._container&&this._container.translate(vector);for(line in this.lines)this.lines[line].point=this.lines[line].point.add(vector);for(_ref=this.children,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],_results.push(child.translate(vector));return _results},BlockPaper}(IcePaper),SocketPaper=function(_super){function SocketPaper(block){this.block=block,this.empty=!1}return __extends(SocketPaper,_super),SocketPaper.prototype._recopy=function(){var contentPaper,line;contentPaper=this.block.content().paper;for(line in contentPaper.lines)this.lines[line]=contentPaper.lines[line];return this.group=contentPaper.group},SocketPaper.prototype.compute=function(state){var content;return this.lines={},null!=(content=this.block.content())?(content.paper.compute(state),this._recopy()):(this.lines[state.line]=new paper.Rectangle(0,0,20,20),this._line=state.line,this.group=new paper.Group([])),this.empty=null!=this.block.content,this},SocketPaper.prototype.draw=function(){return null!=this._container&&this._container.remove(),null!=this.block.content()?(this.block.content().paper.draw(),this.group=this.block.group):(this._container=new paper.Path.Rectangle(this.lines[this._line]),this._container.strokeColor="black",this._dropArea=this._container.clone(),this._dropArea.strokeColor=null,this.group.addChild(this._container),this.group.addChild(this._dropArea))},SocketPaper.prototype.erase=function(){return null!=this._container?this._container.remove():void 0},SocketPaper.prototype.setLeftCenter=function(line,point){return null!=this.block.content()?(this.block.content().paper.setLeftCenter(line,point),this.lines[line]=this.block.content().paper.lines[line]):this.lines[line].point=point.subtract(0,this.lines[line].height/2)},SocketPaper.prototype.translate=function(vector){return null!=this.block.content()?(this.block.content().paper.translate(vector),this._recopy()):this.lines[this._line].point=this.lines[this._line].point.add(vector)},SocketPaper}(IcePaper),TextTokenPaper=function(_super){function TextTokenPaper(block){this.block=block}return __extends(TextTokenPaper,_super),TextTokenPaper.prototype.compute=function(state){return null!=this.text&&this.text.remove(),this.text=new paper.PointText(new paper.Point(0,0)),this.text.content=this.block.value,this.text.fillColor="black",this.text.font="Courier New",this.text.fontSize=18,this.group=new paper.Group([this.text]),this.lines={},this.lines[state.line]=this.text.bounds,this.line=state.line,this},TextTokenPaper.prototype.draw=function(){},TextTokenPaper.prototype.erase=function(){return null!=this.text?this.text.remove():void 0},TextTokenPaper.prototype.setLeftCenter=function(line,point){return line in this.lines&&(this.text.position=new paper.Point(point.x+this.text.bounds.width/2,point.y)),this.lines[this.line]=this.text.bounds},TextTokenPaper.prototype.translate=function(vector){return this.text.translate(vector),this.lines[this.line].point=this.lines[this.line].point.add(vector)},TextTokenPaper}(IcePaper),window.onload=function(){var a,highlight,offset,out,roots,selection,tool;if(window.RUN_PAPER_TESTS)return paper.setup(document.getElementById("canvas")),a=ICE.indentParse("(lambda (x\n  (y)))"),a.block.paper.compute({line:0}),a.block.paper.draw(),paper.view.draw(),tool=new paper.Tool,selection=null,highlight=null,offset=new paper.Point(0,0),event.point=new paper.Point(0,0),roots=[],tool.onMouseDown=function(event){var block,found,parent_root,pos,root,_i,_len;for(block=a.block.findBlock(function(block){return null!=block.paper._container.hitTest(event.point)}),parent_root=null,_i=0,_len=roots.length;_len>_i;_i++)root=roots[_i],null!=root.paper._container.hitTest(event.point)&&(block=root),found=root.findBlock(function(block){return null!=block.paper._container.hitTest(event.point)}),found!==root&&(block=found,parent_root=root);return block===a.block?(selection=null,void 0):(null!=block.start.prev&&"newline"===block.start.prev.type&&block.start.prev.remove(),block._moveTo(null),selection=block.paper,offset=selection.group.position.subtract(event.point),a.block.paper.erase(),a.block.paper.compute({line:0}),a.block.paper.draw(),null!=parent_root&&(pos=parent_root.paper.group.position,parent_root.paper.erase(),parent_root.paper.compute({line:0}),parent_root.paper.draw(),parent_root.paper.group.position=pos),out.innerText=a.block.toString({indent:""}),selection.erase(),selection.compute({line:0}),selection.draw(),selection.group.position=event.point.add(offset))},out=document.getElementById("out"),tool.onMouseUp=function(){return null!=highlight&&null!=selection&&("block"===highlight.type?selection.block._moveTo(highlight.end.insert(new NewlineToken)):"indent"===highlight.type?selection.block._moveTo(highlight.start.insert(new NewlineToken)):"socket"===highlight.type&&selection.block._moveTo(highlight.start),a.block.paper.erase(),a.block.paper.compute({line:0}),a.block.paper.draw(),out.innerText=a.block.toString({indent:""})),null!=selection&&null==highlight&&roots.push(selection.block),highlight=selection=null},tool.onMouseMove=function(event){if(null!=selection){if(selection.group.position=event.point.add(offset),null!=highlight&&(highlight.paper._dropArea.fillColor=null),highlight=a.block.find(function(block){return null!=block.paper._dropArea&&block.paper._dropArea.bounds.contains(selection.group.bounds.point)&&"socketStart"!==block.start.prev.type}),highlight===a.block)return highlight=null;if(null!=highlight.paper.group&&highlight.paper.group.bringToFront(),highlight.paper._dropArea.bringToFront(),selection.group.bringToFront(),highlight!==a.block)return highlight.paper._dropArea.fillColor="red"}}}}).call(this);